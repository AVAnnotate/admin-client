---
import Project from '@apps/Projects/Project';
import { getProject } from '@backend/projectHelpers';
import { userInfo } from '@backend/userInfo';
import Layout from '@layouts/Layout.astro';

const { lang, slug } = Astro.params;

const info = await userInfo(Astro.cookies);

if (!info || !slug) {
  console.log('Redirecting: ', lang);
  return Astro.redirect(`/${lang}/sign-in`);
}

const split = slug.split(/-(.*)/s);
const org = split[0];
const repoName = split[1];

const baseUrl = 'https://github.com';
const repoUrl = `${baseUrl}/${org}/${repoName}`;

const projectData = await getProject(info, repoUrl);
---

<Layout title='Projects' profile={info.profile}>
  <Project project={projectData} />
</Layout>
